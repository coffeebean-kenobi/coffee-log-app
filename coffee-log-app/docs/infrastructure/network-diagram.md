# ネットワーク図

## システム全体のネットワークアーキテクチャ

```
                                                ┌───────────────────┐
                                                │                   │
                                                │   ユーザー         │
                                                │   (ブラウザ)       │
                                                │                   │
                                                └─────────┬─────────┘
                                                          │
                                                          │ HTTPS
                                                          │
                         ┌──────────────────────────────┐ │ ┌──────────────────────────────┐
                         │                              │ │ │                              │
┌───────────┐            │         Vercel CDN          │◄┼─┼─┤      Vercel Edge Network    │
│           │            │     (静的コンテンツ配信)       │ │ │      (サーバーレス関数)      │
│   開発     │            │                              │ │ │                              │
│ 環境      ├───Git Push─►│                              │ │ │                              │
│           │            └──────────────────────────────┘ │ └──────────────────────────────┘
└───────────┘                                             │               │
                                                          │               │
                                                          │               │ API Calls
                                                          │               │
                         ┌──────────────────────────────┐ │ ┌──────────────────────────────┐
                         │                              │ │ │                              │
                         │       Supabase API          │◄┼─┼─┤       Supabase Storage      │
                         │    (データアクセス層)         │ │ │        (ファイル保存)        │
                         │                              │ │ │                              │
                         └───────────────┬──────────────┘ │ └──────────────────────────────┘
                                         │                │
                                         │                │
                                         │                │
                         ┌───────────────▼──────────────┐ │
                         │                              │ │
                         │      Supabase Database      │ │
                         │      (PostgreSQL)           │ │
                         │                              │ │
                         └──────────────────────────────┘ │
                                                          │
                                                          │
```

## ネットワークフロー詳細

### 1. ユーザーアクセスフロー

```
┌─────────┐     HTTPS     ┌───────────┐    Next.js    ┌─────────────┐
│         │ ────────────► │           │ ────────────► │             │
│ ユーザー  │               │  Vercel   │               │  ページ     │
│ ブラウザ  │ ◄──────────── │  Edge     │ ◄──────────── │  レンダリング │
│         │    レスポンス   │           │    HTML       │             │
└─────────┘               └───────────┘               └─────────────┘
```

### 2. 認証フロー

```
┌─────────┐    認証        ┌───────────┐     JWT       ┌─────────────┐
│         │ ────────────► │           │ ────────────► │             │
│ ユーザー  │  リクエスト     │  Next.js  │               │  Supabase   │
│ ブラウザ  │ ◄──────────── │  App      │ ◄──────────── │  Auth       │
│         │  JWT トークン   │           │  認証レスポンス  │             │
└─────────┘               └───────────┘               └─────────────┘
```

### 3. データアクセスフロー

```
┌─────────┐   API         ┌───────────┐     SQL       ┌─────────────┐
│         │ ────────────► │           │ ────────────► │             │
│ Next.js │  リクエスト     │  Supabase │               │  PostgreSQL │
│  App    │ ◄──────────── │  API      │ ◄──────────── │  データベース  │
│         │  JSON レスポンス │           │  クエリ結果    │             │
└─────────┘               └───────────┘               └─────────────┘
```

### 4. 画像アップロードフロー

```
┌─────────┐   ファイル      ┌───────────┐   保存        ┌─────────────┐
│         │ ────────────► │           │ ────────────► │             │
│ ブラウザ  │  アップロード   │  Next.js  │               │  Supabase   │
│         │ ◄──────────── │  App      │ ◄──────────── │  Storage    │
│         │  URL レスポンス  │           │  保存確認      │             │
└─────────┘               └───────────┘               └─────────────┘
```

## ネットワークセキュリティ

### セキュリティレイヤー

```
┌────────────────────────────────────────────────────────────────────┐
│                        アプリケーションセキュリティ                      │
│                                                                    │
│  ┌────────────────┐   ┌────────────────┐   ┌────────────────┐      │
│  │                │   │                │   │                │      │
│  │    HTTPS       │   │  JWT認証       │   │ CSRFトークン    │      │
│  │                │   │                │   │                │      │
│  └────────────────┘   └────────────────┘   └────────────────┘      │
│                                                                    │
└────────────────────────────────────────────────────────────────────┘

┌────────────────────────────────────────────────────────────────────┐
│                        データセキュリティ                            │
│                                                                    │
│  ┌────────────────┐   ┌────────────────┐   ┌────────────────┐      │
│  │                │   │                │   │                │      │
│  │ Row Level     │   │ データ暗号化    │   │ 入力検証       │      │
│  │ Security      │   │                │   │                │      │
│  └────────────────┘   └────────────────┘   └────────────────┘      │
│                                                                    │
└────────────────────────────────────────────────────────────────────┘
```

## ネットワーク設定要件

### CORS設定

- 許可オリジン: `https://coffee-log-app.vercel.app`
- 許可メソッド: GET, POST, PUT, DELETE
- 認証ヘッダー: 許可

### ファイアウォール設定

- Supabase API (TCP/443): 許可
- Vercel Edge Functions (TCP/443): 許可
- 管理ポート: 特定IPのみ許可

### SSL/TLS設定

- TLS 1.2以上を使用
- 強力な暗号スイートのみ許可
- HSTS (HTTP Strict Transport Security) 有効

## ネットワークモニタリング

- Vercel Analytics によるパフォーマンスモニタリング
- Supabase ダッシュボードによるAPIリクエスト監視
- エラーロギングとアラート通知設定 