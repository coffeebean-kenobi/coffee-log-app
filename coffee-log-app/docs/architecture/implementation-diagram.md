# 実装概念図

## コンポーネント構造図

```
┌─────────────────────────────────────────────────────────────────┐
│                         Layout (app/layout.tsx)                  │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                     Page Components                      │   │
│  │                                                         │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │   │
│  │  │   Home      │  │  Coffee     │  │  Profile    │     │   │
│  │  │  (page.tsx) │  │ (coffee/*.tsx) │ (profile/*.tsx) │     │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘     │   │
│  │                                                         │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                    Shared Components                     │   │
│  │                                                         │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │   │
│  │  │   Header    │  │  Footer     │  │  Navigation │     │   │
│  │  │             │  │             │  │             │     │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘     │   │
│  │                                                         │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

## データフロー概念図

```
┌───────────┐         ┌───────────┐         ┌───────────┐
│           │         │           │         │           │
│  ユーザー   │ ───────► │  Next.js  │ ───────► │ Supabase  │
│ インタラクション │         │   App     │         │           │
│           │ ◄─────── │           │ ◄─────── │           │
└───────────┘         └───────────┘         └───────────┘
                          │  ▲
                          │  │
                          ▼  │
                      ┌───────────┐
                      │           │
                      │ ブラウザ    │
                      │ ストレージ   │
                      │           │
                      └───────────┘
```

## 認証フロー実装図

```
┌───────────┐        ┌───────────┐        ┌───────────┐
│           │        │           │        │           │
│  サインアップ │        │  Supabase  │        │  データベース │
│  フォーム    │───────►│   Auth    │───────►│           │
│           │        │           │        │           │
└───────────┘        └───────────┘        └───────────┘
                          │
                          │
                          ▼
                    ┌───────────┐
                    │           │
                    │  JWT     │
                    │  トークン   │
                    │           │
                    └───────────┘
                          │
                          │
                          ▼
                    ┌───────────┐
                    │           │
                    │ Cookie    │
                    │ ストレージ   │
                    │           │
                    └───────────┘
```

## コーヒーログ作成フロー実装図

```
┌───────────┐      ┌───────────┐      ┌───────────┐
│           │      │           │      │           │
│  フォーム    │      │   Form    │      │  Supabase  │
│  入力      │─────►│ Validation │─────►│   API     │
│           │      │   (Zod)   │      │           │
└───────────┘      └───────────┘      └───────────┘
    │                                        │
    │                                        │
    ▼                                        ▼
┌───────────┐                          ┌───────────┐
│           │                          │           │
│  画像      │                          │  Supabase  │
│  アップロード │─────────────────────────►│  Storage  │
│           │                          │           │
└───────────┘                          └───────────┘
```

## データ分析実装フロー

```
┌───────────┐      ┌───────────┐      ┌───────────┐
│           │      │           │      │           │
│  Supabase  │      │  データ    │      │  Chart.js  │
│  データ取得  │─────►│  処理     │─────►│  レンダリング │
│           │      │           │      │           │
└───────────┘      └───────────┘      └───────────┘
```

## ミドルウェア実装図

```
┌───────────┐      ┌───────────┐      ┌───────────┐
│           │      │           │      │           │
│  リクエスト  │      │ Next.js   │      │  保護された │
│           │─────►│ Middleware │─────►│  ルート    │
│           │      │           │      │           │
└───────────┘      └───────────┘      └───────────┘
      │                  │
      │                  │
      ▼                  ▼
┌───────────┐      ┌───────────┐
│           │      │           │
│ リダイレクト │      │ Supabase  │
│ (未認証)   │      │ Session   │
│           │      │ 検証       │
└───────────┘      └───────────┘
``` 