# 詳細設計

## ユーザー認証フロー

### サインアップフロー
1. ユーザーがサインアップページにアクセス
2. メールアドレスとパスワードを入力
3. Zod によるフォームバリデーション
4. Supabase Auth API にリクエスト送信
5. 認証成功時、ユーザープロフィール作成ページへリダイレクト
6. プロフィール情報の登録
7. ホームページへリダイレクト

### サインインフロー
1. ユーザーがサインインページにアクセス
2. メールアドレスとパスワードを入力
3. Supabase Auth API で認証
4. 認証成功時、JWT トークンを Cookie に保存
5. ホームページへリダイレクト

### 認証状態管理
- ミドルウェアによる保護されたルートの管理
- Supabase Auth Helpers によるセッション管理
- サーバーサイドでの認証状態チェック

## コーヒーログ機能

### コーヒー記録作成フロー
1. ユーザーが新規コーヒーログ作成ページにアクセス
2. コーヒー情報（名前、種類、産地、焙煎度など）を入力
3. テイスティングノートや評価を記録
4. 画像をアップロード（オプション）
5. データバリデーション
6. Supabase にデータ保存
7. 画像がある場合は Storage にアップロード
8. コーヒー詳細ページへリダイレクト

### コーヒー一覧表示
1. ページロード時に Supabase からユーザーのコーヒーログを取得
2. 日付順/評価順などでソート
3. フィルタリングオプション提供
4. ページネーション実装

### コーヒー詳細表示
1. URL パラメータからコーヒー ID を取得
2. Supabase からデータをフェッチ
3. 詳細情報の表示
4. 編集・削除オプションの提供

## データ分析機能

### 統計情報生成
1. ユーザーのすべてのコーヒーログを取得
2. データ集計処理（種類別、産地別、評価別など）
3. Chart.js を用いたグラフ生成
4. インタラクティブなフィルタリングオプション

### 時系列分析
1. 日付範囲で絞り込んだコーヒーログの取得
2. 時間軸に沿ったデータ整形
3. トレンド分析と可視化

## エラーハンドリング

### クライアントサイド
- React Hook Form と Zod によるバリデーションエラー表示
- API リクエスト失敗時のエラー処理
- フォールバック UI の実装

### サーバーサイド
- Next.js のエラーページ実装
- API ルートでのエラーレスポンス統一
- ログ記録システム

## パフォーマンス最適化

### データフェッチング
- Server Components でのデータ取得
- クライアントキャッシュの活用
- Suspense と Streaming の実装

### 画像最適化
- Next.js Image コンポーネントの使用
- Responsive 画像の実装
- 画像フォーマットと圧縮の最適化

### バンドルサイズ最適化
- コード分割
- 動的インポート
- 未使用コードの削除 